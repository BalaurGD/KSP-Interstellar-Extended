PART 
{
    name = KspiAntimatterPlasmaEngine
    module = Part
    author = KerboNerd
    mesh = plasmaEngine1.mu
    rescaleFactor = 1
    mass = 12
    emissiveConstant = 0.8 
    dragModelType = default
    maximum_drag = 0.2
    minimum_drag = 0.2
    angularDrag = 2
    breakingForce = 400
    breakingTorque = 400
    crashTolerance = 22
    maxTemp = 2000 
    TechRequired = start
    entryCost = 0
    cost = 183500
    category = Engine
    subcategory = 0
    title = Plasma Antimatter Engine
    manufacturer = C.E.D.A Warp Tech Division

    description = Similar to Gas Core Antimatter, but more antimatter is used so the propellant actually does become plasma. The reaction chamber has to be a magnetic bottle since there is no way to prevent a solid walled reaction chamber from exploding. The drawback is that a magnetic bottle drastically reduces the propellant mass flow, which drastically reduces the amount of thrust. The advantage is the specific impulse is much higher.  Its manufacturer claims you should remain positive because "it is the last reactor you will ever look at", but we are not quite sure what they mean...

    attachRules = 1,0,1,1,0
    bulkheadProfiles = ceda_torch
    tags = ceda_warp

	NODE 
	{
		name = top
		transform = node_stack_top
		size = 2
		method = FIXED_JOINT
		crossfeed = True
		rigid = False
	}

	NODE 
	{
		name = bottom
		transform = node_stack_bottom
		size = 1
		method = FIXED_JOINT
		crossfeed = True
		rigid = False
	}

	MODULE
	{
		name = TweakScale
		type = stack_interstellar_225
		defaultScale = 2.5
		scaleFactors = 2.5, 3.75, 5, 7.5, 10, 15, 20, 30, 40, 60, 80
	}

	MODULE
	{
		name = FNAntimatterReactor
		supportMHD = true

		reactorSpeedMult = 0 				// instant acceleration
		showForcedMinimumThrottle = false

		hotBathTemperatureMk1 = 3500
		hotBathTemperatureMk2 = 4000
		hotBathTemperatureMk3 = 4500

		upgradeTechReqMk2 = ThermalAntimatterReactorUpgrade4
		upgradeTechReqMk3 = ThermalAntimatterReactorUpgrade5

		basePowerOutputMk1 = 100000
		basePowerOutputMk2 = 200000
		basePowerOutputMk3 = 400000

		coreTemperatureMk1 = 4000000			// 4 Million degree
		coreTemperatureMk2 = 4000000			// 4 Million degree
		coreTemperatureMk3 = 4000000			// 4 Million degree

		animName = e13
		partMass = 10
		radius = 2.5
		consumeGlobal = true
		reactorType = 32

		usePropellantBaseIsp = true			// uses Pure isp
		minCoolingFactor = 1				// Can use any liquid propellant
		supportedPropellantAtoms = 511			// All atom
		supportedPropellantTypes = 511			// Any type

		fuelEfficiency = 1
		upgradedFuelEfficiency = 1

		//engineHeatProductionMult = 0.01 		// keep thermal nozzle thermalheat production at 1%
		//engineWasteheatProductionMult = 0.01		// keep thermal nozzle wasteheat production at 1%

		//plasmaHeatProductionMult = 0.05		// reduce plasma engine thermalheat production to 50%
		//plasmaWasteheatProductionMult = 0.05		// reduce plasma engine wasteheat production to 5%

		plasmaPropulsionEfficiency = 1			// can use plasma nozzle
		plasmaEnergyEfficiency = 0			// cannot use MHD generator
		thermalEnergyEfficiency = 0			// cannot use thermal generator
		thermalPropulsionEfficiency = 0			// cannot use thermal nozzle
		chargedParticlePropulsionEfficiency = 0		// cannot use magnetic nozzle
		chargedParticleEnergyEfficiency = 0		// cannot use direct converter

		magneticNozzlePowerMult = 0.05			// 5% of normal magnetic/plasma nozze power cost

		neutronEmbrittlementLifepointsMax = 100
		thermalProcessingModifier = 0.1			// influences the mass of connected power generators

		electricPowerPriority = 4 			// determines default power production priority for connected generator
	}

	MODULE
	{
		name = ModuleEnginesWarp

		propellant1 = LqdHydrogen
		ratio1 = 1

		engineID = Hydrogen
		resourceDeltaV = LqdHydrogen

		thrustVectorTransformName = thrustTransform
		exhaustDamage = True
		ignitionThreshold = 0.1
		minThrust = 0
		maxThrust = 500
		heatProduction = 10
		fxOffset = 0, 0, 1

		PROPELLANT
		{
			name = LqdHydrogen
			ratio = 1
			DrawGauge = True
		}
		atmosphereCurve
		{
			key = 0 10000
			key = 1 100
		}
	}

	MODULE
	{
		name = PlasmaNozzleController

		originalName = #LOC_KSPIE_KspiMagneticNozzle_ThermalNozzleController_origi	// Plasma Nozzle
		upgradeTechReq = true

		plasmaAfterburnerRange = 2
		isPlasmaNozzle = true
		IspTempMultOffset = -0.2357269918213

		isJet = false
		radius = 2.5
		exitArea = 5
		partMass = 4 

		sootHeatDivider = 50
		sootThrustDivider = 150	

		requiredMegajouleRatio = 0.05
		heatProductionMult = 0.005
		heatProductionExponent = 7

		maxTemp = 2500
		showPartTemperature = true

		powerTrustMultiplier = 1
		powerTrustMultiplierJet = 1

		EffectNameLithium = plasma-nozzle-plume
		EffectNameNonLFO = plasma-nozzle-plume
	}

	RESOURCE
	{
		name = WasteHeat
		amount = 0
		maxAmount = 1
	}

	RESOURCE
	{
		name = ThermalPower
		amount = 1
		maxAmount = 1
	}

	RESOURCE
	{
		name = ChargedParticles
		amount = 0
		maxAmount = 1
	}

	MODULE
	{
		name = ModuleGimbal
		gimbalTransformName = thrustTransform
		gimbalRange = 1
	}

	MODULE
	{
		name = IntegratedRadiator
	}

	MODULE:NEEDS[Waterfall]
	{
		name = ModuleWaterfallFX
		moduleID = KspiMagneticNozzle
		engineID = Hydrogen
		CONTROLLER
		{
			name = throttleController
			linkedTo = throttle
		}
		CONTROLLER
		{
			name = propellantFuel
			linkedTo = custom
		}
		EFFECT
		{
			name = mainExhaust
			parentName = thrustTransform
			MODEL
			{
				path = Waterfall/FX/fx-cylinder
				positionOffset = 0,0,-0.400000006
				rotationOffset = -90,0,0
				scaleOffset = 1,30,1
				MATERIAL
				{
					transform = Cylinder
					shader = Waterfall/Additive (Dynamic)
					randomizeSeed = True
					FLOAT
					{
						floatName = _ExpandOffset
						value = -1
					}
					FLOAT
					{
						floatName = _ExpandBounded
						value = 2.51555347
					}
					FLOAT
					{
						floatName = _ExpandLinear
						value = 0.101110943
					}
					FLOAT
					{
						floatName = _ExpandSquare
						value = 10
					}
					FLOAT
					{
						floatName = _Noise
						value = 3.79999995
					}
					FLOAT
					{
						floatName = _Falloff
						value = 7.30000019
					}
					TEXTURE
					{
						textureSlotName = _MainTex
						texturePath = Waterfall/FX/fx-noise-5
						textureScale = 1,1
						textureOffset = 0,0
					}
					FLOAT
					{
						floatName = _SpeedY
						value = 9
					}
					FLOAT
					{
						floatName = _Symmetry
						value = 0
					}
					FLOAT
					{
						floatName = _TintFalloff
						value = 0.5
					}
					FLOAT
					{
						floatName = _FadeOut
						value = 0.200000003
					}
					COLOR
					{
						colorName = _StartTint
						colorValue = 0.980392158, 0.290196091,0.223529413,1
					}
					COLOR
					{
						colorName = _EndTint
						colorValue = 0.988235295, 0.615686297,0.533333361,1
					}
					FLOAT
					{
						floatName = _Fresnel
						value = 0.353888333
					}
					FLOAT
					{
						floatName = _TileX
						value = 0.600000024
					}
					FLOAT
					{
						floatName = _TileY
						value = 1.5
					}
				}
			}
			SCALEMODIFIER
			{
				name = plumeLen
				controllerName = throttleController
				transformName = Waterfall/FX/fx-cylinder(Clone)
				combinationType = REPLACE
				useRandomness = False
				randomnessController = random
				randomnessScale = 1
				xCurve
				{
					key = 0 1 0 0
				}
				yCurve
				{
					key = 0 0 0 0
					key = 0.01 10 0 0
					key = 1 30 0 0
				}
				zCurve
				{
					key = 0 1 0 0
				}
			}
			FLOATMODIFIER
			{
				name = plumeBounded
				controllerName = throttleController
				transformName = Cylinder
				combinationType = REPLACE
				useRandomness = False
				randomnessController = random
				randomnessScale = 1
				floatName = _ExpandBounded
				floatCurve
				{
					key = 0 0 0 0
					key = 1 2.5 0 0
				}
			}
			FLOATMODIFIER
			{
				name = plumeSquare
				controllerName = throttleController
				transformName = Cylinder
				combinationType = REPLACE
				useRandomness = False
				randomnessController = random
				randomnessScale = 1
				floatName = _ExpandSquare
				floatCurve
				{
					key = 0 3 0 0
					key = 1 10 0 0
				}
			}
		}
	}
}
